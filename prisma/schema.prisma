// ==========================================
// Prisma Schema - Authentication & Roles
// ==========================================

generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "mysql"
   url      = env("DATABASE_URL")  // ⬅️ ADD THIS LINE BACK

}

// ==========================================
// Enums
// ==========================================
enum UserRole {
  TEACHER
  PRINCIPAL
  ADMIN
}

// ==========================================
// Core User & Authentication
// ==========================================
model User {
  id              String          @id @default(cuid())
  name            String
  email           String          @unique
  emailVerified   DateTime?
  password        String?
  phone           String?
  role            UserRole        @default(TEACHER) 
  image           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  passwordResets  PasswordReset[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String  @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expires   DateTime

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ==========================================
// Newsletter Subscription
// ==========================================
model Subscriber {
  id        String    @id @default(cuid())
  email     String    @unique // Ensures no duplicate subscriptions
  createdAt DateTime  @default(now())

  @@map("subscribers")
}


model Assignment {
  id                 Int       @id @default(autoincrement())
  title              String
  subject            String
  className          String
  teacher            String
  dueDate            DateTime
  dateAssigned       DateTime
  status             String     
  description        String    @db.Text  // Use TEXT type for long content
  instructions       String?   @db.Text  // Use TEXT type for long content
  assignmentFiles    Json      
  attachments        Json      
  priority           String    
  estimatedTime      String?   
  additionalWork     String?   @db.Text  // Use TEXT type for long content
  teacherRemarks     String?   @db.Text  // Use TEXT type for long content
  feedback           String?   @db.Text  // Use TEXT type for long content
  learningObjectives Json      
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
}





// ==========================================
// RESOURCE MODEL
// ==========================================
model Resource {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(255)
  subject     String   @db.VarChar(100)
  className   String   @db.VarChar(50)   // ADDED: Class field
  description String?  @db.Text
  category    String   @default("general") @db.VarChar(100)
  type        String   @default("document") @db.VarChar(50)
  fileUrl     String   @db.VarChar(500)
  fileName    String   @db.VarChar(255)
  fileSize    String   @db.VarChar(50)
  extension   String   @db.VarChar(20)
  accessLevel String   @default("student") @db.VarChar(20)
  uploadedBy  String   @default("System") @db.VarChar(100)
  gradeLevel  String?  @db.VarChar(50)
  downloads   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([subject])
  @@index([className])  // ADDED: Index for class
  @@index([category])
  @@index([type])
  @@index([accessLevel])
  @@index([gradeLevel])
  @@index([createdAt])
  @@map("resources")
}

model CounselingEvent {
  id            Int      @id @default(autoincrement())
  counselor     String
  category      String     // e.g. "Drugs", "Relationships", "Worship", "Discipline", "Academics", etc.
  description   String
  notes         String?
  date          DateTime
  time          String
  type          String      // e.g. "Guidance", "Counseling", "Group Session"
  priority      String      // e.g. "High", "Medium", "Low"
  image         String?     // Optional attachment (photo, PDF, DOC)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Event {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  date         DateTime
  time         String
  location     String
  category     String
  type         String
  featured     Boolean  @default(false)
  registration Boolean  @default(false)
  attendees    String   // now a string: "student" or "staff"
  speaker      String
  image        String?  // optional
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model News {
  id          Int      @id @default(autoincrement())
  title       String
  excerpt     String
  fullContent String
  date        DateTime
  category    String
  author      String
  likes       Int      @default(0)
  image       String?  // optional
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model Staff {
  id           Int      @id @default(autoincrement())
  name         String
  role         String          // Principal, Deputy, Teacher, BOM Member, etc.
  position     String?         // Optional additional info
  department   String          // Administration, Sciences, Languages, etc.
  email        String?
  phone        String?
  bio          String
  responsibilities Json         // Store as JSON
  expertise    Json             // Store as JSON
  achievements Json             // Store as JSON
  image        String?          // Optional image path
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
model EmailCampaign {
  id            String   @id @default(cuid())
  title         String
  subject       String
  content       String   @db.Text
  recipients    String
  recipientType String   @default("all")
  status        String   @default("draft")
  sentAt        DateTime?
  sentCount     Int?
  failedCount   Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("email_campaigns")
}
model GalleryImage {
  id          Int        @id @default(autoincrement())
  title       String
  description String?
  category    Category   // Single unified category field
  files       Json       // store array of file paths (images/videos)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum Category {
  GENERAL
  CLASSROOMS
  LABORATORIES
  DORMITORIES
  DINING_HALL
  SPORTS_FACILITIES
  
  // Academic
  TEACHING
  SCIENCE_LAB
  COMPUTER_LAB
  
  // Events
  SPORTS_DAY
  MUSIC_FESTIVAL
  DRAMA_PERFORMANCE
  ART_EXHIBITION
  DEBATE_COMPETITION
  SCIENCE_FAIR
  
  // Administrative
  ADMIN_OFFICES
  STAFF
  PRINCIPAL
  BOARD
  
  // Special Occasions
  GRADUATION
  AWARD_CEREMONY
  PARENTS_DAY
  OPEN_DAY
  VISITORS
  
  // Student Life
  STUDENT_ACTIVITIES
  CLUBS
  COUNCIL
  LEADERSHIP
  
  OTHER
}


model Student {
  id                  Int      @id @default(autoincrement())
  admissionNumber     String   @unique
  name                String
  form                String
  stream              String
  gender              String
  dateOfBirth         DateTime
  enrollmentDate      DateTime
  kcpeMarks           Int?
  previousSchool      String?
  parentName          String
  parentEmail         String?
  parentPhone         String
  emergencyContact    String
  address             String
  medicalInfo         String?
  hobbies             String?
  academicPerformance String
  attendance          String
  disciplineRecord    String
  status              String   @default("Active")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  councilPositions StudentCouncil[]   @relation("StudentToStudentCouncil")
  isClassPrefect      Boolean        @default(false)
  isClassAssistant    Boolean        @default(false)
  isBellRinger        Boolean        @default(false)

  promotionHistory PromotionHistory[]
}


// ==========================================
// Student Council & Leadership
// ==========================================
model StudentCouncil {
  id                String           @id @default(cuid())
  position          CouncilPosition
  department        CouncilDepartment?
  studentId         Int
  student           Student          @relation(name: "StudentToStudentCouncil", fields: [studentId], references: [id], onDelete: Cascade)
  form              String?          // Add for class-specific roles
  stream            String?          // Add for class-specific roles
  startDate         DateTime
  endDate           DateTime?
  status            CouncilStatus    @default(Active)
  image             String?
  achievements      String?
  responsibilities  String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@unique([studentId, position, department, form, stream])
  @@map("student_councils")
}



enum CouncilStatus {
  Active
  Inactive
  Graduated
}




enum CouncilPosition {
  President
  DeputyPresident
  SchoolCaptain
  DeputyCaptain
  AcademicsSecretary
  SportsSecretary
  EntertainmentSecretary
  CleaningSecretary
  MealsSecretary
  BellRinger
  DisciplineSecretary
  HealthSecretary
  LibrarySecretary
  TransportSecretary
  EnvironmentSecretary
  SpiritualSecretary
  TechnologySecretary
  Assistant
  ClassRepresentative  // For class reps
  ClassAssistant       // For class assistants
}
enum CouncilDepartment {
  Presidency
  Academics
  Sports
  Entertainment
  Cleaning
  Meals
  Discipline
  Health
  Library
  Transport
  Environment
  Spiritual
  Technology
  General
}
model PromotionHistory {
  id          Int      @id @default(autoincrement())
  studentId   Int
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  fromForm    String
  toForm      String
  fromStream  String
  toStream    String
  promotedAt  DateTime @default(now())
  promotedBy  String   @default("System")

  @@index([studentId])
  @@index([promotedAt])
}

model SchoolInfo {
  id                          Int       @id @default(autoincrement())
  name                        String
  description                 String   @db.Text
  videoTour                   String?   // URL or local path
  videoType                  String?   // "youtube" | "file"
  studentCount                Int
  staffCount                  Int
  feesBoarding                Float
  feesDay                     Float
  feesDistribution           Json
  openDate                   DateTime
  closeDate                  DateTime
  subjects                   Json
  departments                Json
  curriculumPDF              String?   // uploaded curriculum PDF path
  
  // New Admission Fields
  admissionOpenDate          DateTime?  // When admissions open
  admissionCloseDate         DateTime?  // When admissions close
  admissionRequirements      String?   @db.Text  // Admission requirements text
  admissionFee               Float?     // Admission fee (not application fee)
  admissionCapacity          Int?       // Maximum number of students to admit
  admissionContactEmail      String?    // Contact email for admissions
  admissionContactPhone      String?    // Contact phone for admissions
  admissionWebsite           String?    // Admissions website URL
  admissionLocation          String?    // Admission office location
  admissionOfficeHours       String?    // Office hours for admissions
  admissionDocumentsRequired Json?      // List of required documents for admission
  
  createdAt                  DateTime  @default(now())
  updatedAt                  DateTime  @updatedAt
}

// =====================================================
// SIMPLIFIED HIGH SCHOOL ADMISSION SCHEMA
// =====================================================
model AdmissionApplication {
  // ====================
  // IDENTIFICATION
  // ====================
  id                String   @id @default(cuid())
  applicationNumber String   @unique
  
  // ====================
  // PERSONAL INFORMATION
  // ====================
  firstName         String
  middleName        String?
  lastName          String
  gender            String
  dateOfBirth       DateTime
  nationality       String
  county            String
  constituency      String
  ward              String
  village           String?
  
  // ====================
  // CONTACT INFORMATION
  // ====================
  email             String   @unique
  phone             String
  alternativePhone  String?
  postalAddress     String
  postalCode        String?
  
  // ====================
  // PARENT/GUARDIAN INFORMATION
  // ====================
  fatherName        String?
  fatherPhone       String?
  fatherEmail       String?
  fatherOccupation  String?
  motherName        String?
  motherPhone       String?
  motherEmail       String?
  motherOccupation  String?
  guardianName      String?
  guardianPhone     String?
  guardianEmail     String?
  guardianOccupation String?
  
  // ====================
  // ACADEMIC INFORMATION
  // ====================
  previousSchool    String
  previousClass     String
  kcpeYear          Int?
  kcpeIndex         String?
  kcpeMarks         Int?
  meanGrade         String?
  
  // ====================
  // PREFERENCES
  // ====================
  preferredStream   String  // SCIENCE, ARTS, BUSINESS, TECHNICAL
  
  // ====================
  // MEDICAL INFORMATION
  // ====================
  medicalCondition  String?
  allergies         String?
  bloodGroup        String?
  
  // ====================
  // EXTRACURRICULAR
  // ====================
  sportsInterests   String?
  clubsInterests    String?
  talents           String?
  
  // ==========================================
  // ADMISSION DECISION FIELDS
  // ==========================================
  
  // STATUS
  status            String?      @default("PENDING")  
  // PENDING, UNDER_REVIEW, INTERVIEW_SCHEDULED, INTERVIEWED, 
  // ACCEPTED, CONDITIONAL_ACCEPTANCE, WAITLISTED, REJECTED, WITHDRAWN
  
  // DECISION DETAILS
  decisionNotes     String?
  admissionOfficer  String?
  decisionDate      DateTime?
  
  // ACCEPTANCE DETAILS
  admissionDate     DateTime?
  assignedStream    String?
  reportingDate     DateTime?
  admissionLetterSent Boolean?   @default(false)
  
  // REJECTION DETAILS
  rejectionDate     DateTime?
  rejectionReason   String?
  alternativeSuggestions String?
  
  // WAITLIST DETAILS
  waitlistPosition  Int?
  waitlistNotes     String?
  
  // INTERVIEW DETAILS
  interviewDate     DateTime?
  interviewTime     String?
  interviewVenue    String?
  interviewNotes    String?
  
  // CONDITIONAL ACCEPTANCE
  conditions        String?
  conditionDeadline DateTime?
  
  // SCHOOL-SPECIFIC INFO
  houseAssigned     String?      // School house assignment
  admissionClass    String?      // Form 1A, Form 1B, etc
  admissionType     String?      // Regular, Special Needs, etc
  
  // DOCUMENT TRACKING
  documentsVerified Boolean?     @default(false)
  documentsNotes    String?
  
  // ====================
  // TIMESTAMPS
  // ====================
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  
  // ====================
  // INDEXES
  // ====================
  @@index([applicationNumber])
  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([createdAt])
  @@index([decisionDate])
  @@index([county])
  @@index([preferredStream])
  @@index([kcpeMarks])
}