generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  name           String
  email          String          @unique
  emailVerified  DateTime?
  password       String?
  phone          String?
  role           UserRole        @default(TEACHER)
  image          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  passwordResets PasswordReset[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expires   DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "PasswordReset_userId_fkey")
}

model Subscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())

  @@map("subscribers")
}

model Assignment {
  id                 Int      @id @default(autoincrement())
  title              String
  subject            String
  className          String
  teacher            String
  dueDate            DateTime
  dateAssigned       DateTime
  status             String
  description        String   @db.Text
  instructions       String?  @db.Text
  assignmentFiles    Json
  attachments        Json
  priority           String
  estimatedTime      String?
  additionalWork     String?  @db.Text
  teacherRemarks     String?  @db.Text
  feedback           String?  @db.Text
  learningObjectives Json
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Resource {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(255)
  subject     String   @db.VarChar(100)
  className   String   @db.VarChar(50)
  description String?  @db.Text
  category    String   @default("general") @db.VarChar(100)
  type        String   @default("document") @db.VarChar(50)
  fileUrl     String   @db.VarChar(500)
  fileName    String   @db.VarChar(255)
  fileSize    String   @db.VarChar(50)
  extension   String   @db.VarChar(20)
  accessLevel String   @default("student") @db.VarChar(20)
  uploadedBy  String   @default("System") @db.VarChar(100)
  gradeLevel  String?  @db.VarChar(50)
  downloads   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([subject])
  @@index([className])
  @@index([category])
  @@index([type])
  @@index([accessLevel])
  @@index([gradeLevel])
  @@index([createdAt])
  @@map("resources")
}

model CounselingEvent {
  id          Int      @id @default(autoincrement())
  counselor   String
  category    String
  description String
  notes       String?
  date        DateTime
  time        String
  type        String
  priority    String
  image       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Event {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  date         DateTime
  time         String
  location     String
  category     String
  type         String
  featured     Boolean  @default(false)
  registration Boolean  @default(false)
  attendees    String
  speaker      String
  image        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model News {
  id          Int      @id @default(autoincrement())
  title       String
  excerpt     String
  fullContent String
  date        DateTime
  category    String
  author      String
  likes       Int      @default(0)
  image       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Staff {
  id               Int      @id @default(autoincrement())
  name             String
  role             String
  position         String?
  department       String
  email            String?
  phone            String?
  bio              String
  responsibilities Json
  expertise        Json
  achievements     Json
  image            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model EmailCampaign {
  id            String    @id @default(cuid())
  title         String
  subject       String
  content       String    @db.Text
  recipients    String
  recipientType String    @default("all")
  status        String    @default("draft")
  sentAt        DateTime?
  sentCount     Int?
  failedCount   Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  attachments   String?   @db.Text

  @@map("email_campaigns")
}

model GalleryImage {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  category    Category
  files       Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Student {
  id                  Int                @id @default(autoincrement())
  admissionNumber     String             @unique
  name                String
  form                String
  stream              String
  gender              String
  dateOfBirth         DateTime
  enrollmentDate      DateTime
  kcpeMarks           Int?
  previousSchool      String?
  parentName          String
  parentEmail         String?
  parentPhone         String
  emergencyContact    String
  address             String
  medicalInfo         String?
  hobbies             String?
  academicPerformance String
  attendance          String
  disciplineRecord    String
  status              String             @default("Active")
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  isClassPrefect      Boolean            @default(false)
  isClassAssistant    Boolean            @default(false)
  isBellRinger        Boolean            @default(false)
  promotionHistory    PromotionHistory[]
  councilPositions    StudentCouncil[]   @relation("StudentToStudentCouncil")
}

model StudentCouncil {
  id               String             @id @default(cuid())
  position         CouncilPosition
  department       CouncilDepartment?
  studentId        Int
  form             String?
  stream           String?
  startDate        DateTime
  endDate          DateTime?
  status           CouncilStatus      @default(Active)
  image            String?
  achievements     String?
  responsibilities String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  student          Student            @relation("StudentToStudentCouncil", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, position, department, form, stream])
  @@map("student_councils")
}

model PromotionHistory {
  id         Int      @id @default(autoincrement())
  studentId  Int
  fromForm   String
  toForm     String
  fromStream String
  toStream   String
  promotedAt DateTime @default(now())
  promotedBy String   @default("System")
  student    Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([promotedAt])
}

model SchoolInfo {
  id                           Int       @id @default(autoincrement())
  name                         String
  description                  String?   @db.Text
  motto                        String?   @db.Text
  vision                       String?   @db.Text
  mission                      String?   @db.Text
  videoTour                    String?
  videoType                    String?
  videoThumbnail               String?
  videoThumbnailType           String?
  studentCount                 Int
  staffCount                   Int
  feesDay                      Float?
  feesDayDistributionJson      Json?
  feesDayDistributionPdf       String?
  feesDayPdfName               String?
  feesDayPdfSize               Int?
  feesDayPdfUploadDate         DateTime?
  feesBoarding                 Float?
  feesBoardingDistributionJson Json?
  feesBoardingDistributionPdf  String?
  feesBoardingPdfName          String?
  feesBoardingPdfSize          Int?
  feesBoardingPdfUploadDate    DateTime?
  openDate                     DateTime
  closeDate                    DateTime
  subjects                     Json
  departments                  Json
  curriculumPDF                String?
  curriculumPdfName            String?
  curriculumPdfSize            Int?
  admissionOpenDate            DateTime?
  admissionCloseDate           DateTime?
  admissionRequirements        String?   @db.Text
  admissionFee                 Float?
  admissionFeeDistribution     Json?
  admissionCapacity            Int?
  admissionContactEmail        String?
  admissionContactPhone        String?
  admissionWebsite             String?
  admissionLocation            String?
  admissionOfficeHours         String?
  admissionDocumentsRequired   Json?
  admissionFeePdf              String?
  admissionFeePdfName          String?
  form1ResultsPdf              String?
  form1ResultsPdfName          String?
  form1ResultsPdfSize          Int?
  form1ResultsYear             Int?
  form2ResultsPdf              String?
  form2ResultsPdfName          String?
  form2ResultsPdfSize          Int?
  form2ResultsYear             Int?
  form3ResultsPdf              String?
  form3ResultsPdfName          String?
  form3ResultsPdfSize          Int?
  form3ResultsYear             Int?
  form4ResultsPdf              String?
  form4ResultsPdfName          String?
  form4ResultsPdfSize          Int?
  form4ResultsYear             Int?
  mockExamsResultsPdf          String?
  mockExamsPdfName             String?
  mockExamsPdfSize             Int?
  mockExamsYear                Int?
  kcseResultsPdf               String?
  kcsePdfName                  String?
  kcsePdfSize                  Int?
  kcseYear                     Int?
  additionalResultsFiles       Json?
  createdAt                    DateTime  @default(now())
  updatedAt                    DateTime  @updatedAt

  @@index([name])
  @@index([admissionOpenDate, admissionCloseDate])
  @@index([kcseYear])
}

model AdmissionApplication {
  id                     String    @id @default(cuid())
  applicationNumber      String    @unique
  firstName              String
  middleName             String?
  lastName               String
  gender                 String
  dateOfBirth            DateTime
  nationality            String
  county                 String
  constituency           String
  ward                   String
  village                String?
  email                  String    @unique
  phone                  String
  alternativePhone       String?
  postalAddress          String
  postalCode             String?
  fatherName             String?
  fatherPhone            String?
  fatherEmail            String?
  fatherOccupation       String?
  motherName             String?
  motherPhone            String?
  motherEmail            String?
  motherOccupation       String?
  guardianName           String?
  guardianPhone          String?
  guardianEmail          String?
  guardianOccupation     String?
  previousSchool         String
  previousClass          String
  kcpeYear               Int?
  kcpeIndex              String?
  kcpeMarks              Int?
  meanGrade              String?
  preferredStream        String
  medicalCondition       String?
  allergies              String?
  bloodGroup             String?
  sportsInterests        String?
  clubsInterests         String?
  talents                String?
  status                 String?   @default("PENDING")
  decisionNotes          String?
  admissionOfficer       String?
  decisionDate           DateTime?
  admissionDate          DateTime?
  assignedStream         String?
  reportingDate          DateTime?
  admissionLetterSent    Boolean?  @default(false)
  rejectionDate          DateTime?
  rejectionReason        String?
  alternativeSuggestions String?
  waitlistPosition       Int?
  waitlistNotes          String?
  interviewDate          DateTime?
  interviewTime          String?
  interviewVenue         String?
  interviewNotes         String?
  conditions             String?
  conditionDeadline      DateTime?
  houseAssigned          String?
  admissionClass         String?
  admissionType          String?
  documentsVerified      Boolean?  @default(false)
  documentsNotes         String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  @@index([applicationNumber])
  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([createdAt])
  @@index([decisionDate])
  @@index([county])
  @@index([preferredStream])
  @@index([kcpeMarks])
}

model CareerJob {
  id                  String   @id @default(cuid())
  jobTitle            String
  department          String
  category            String
  jobDescription      String   @db.Text
  requirements        String   @db.Text
  experience          String
  qualifications      String   @db.Text
  positionsAvailable  Int      @default(1)
  jobType             String
  applicationDeadline DateTime
  contactEmail        String?
  contactPhone        String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([jobTitle])
  @@index([department])
  @@index([category])
  @@index([jobType])
  @@index([applicationDeadline])
  @@index([createdAt])
}

model StudentBulkUpload {
  id            String            @id @default(cuid())
  fileName      String
  fileType      String
  status        String            @default("pending")
  uploadedBy    String
  uploadDate    DateTime          @default(now())
  processedDate DateTime?
  totalRows     Int               @default(0)
  validRows     Int               @default(0)
  skippedRows   Int               @default(0)
  errorRows     Int               @default(0)
  errorLog      Json?
  students      databaseStudent[]

  @@map("student_bulk_uploads")
}

model databaseStudent {
  id              String       @id @default(cuid())
  admissionNumber String       @unique @db.VarChar(50)
  firstName       String       @db.VarChar(100)
  middleName      String?      @db.VarChar(100)
  lastName        String       @db.VarChar(100)
  form            String       @db.VarChar(20)
  status          String       @default("active")
  stream          String?      @db.VarChar(50)
  dateOfBirth     DateTime?
  gender          String?      @db.VarChar(20)
  parentPhone     String?      @db.VarChar(20)
  email           String?      @db.VarChar(100)
  address         String?      @db.VarChar(255)
  uploadBatchId   String?
  createdAt       DateTime     @default(now())
  feeBalances     FeeBalance[] @relation("StudentFeeBalances")

  updatedAt   DateTime           @updatedAt
  uploadBatch StudentBulkUpload? @relation(fields: [uploadBatchId], references: [id], onDelete: Cascade)

  @@index([admissionNumber])
  @@index([form])
  @@index([uploadBatchId])
  @@map("students")
}

model StudentStats {
  id            String   @id @default("global_stats")
  totalStudents Int      @default(0)
  form1         Int      @default(0)
  form2         Int      @default(0)
  form3         Int      @default(0)
  form4         Int      @default(0)
  updatedAt     DateTime @updatedAt

  @@map("student_stats")
}

enum UserRole {
  TEACHER
  PRINCIPAL
  ADMIN
}

enum Category {
  GENERAL
  CLASSROOMS
  LABORATORIES
  DORMITORIES
  DINING_HALL
  SPORTS_FACILITIES
  TEACHING
  SCIENCE_LAB
  COMPUTER_LAB
  SPORTS_DAY
  MUSIC_FESTIVAL
  DRAMA_PERFORMANCE
  ART_EXHIBITION
  DEBATE_COMPETITION
  SCIENCE_FAIR
  ADMIN_OFFICES
  STAFF
  PRINCIPAL
  BOARD
  GRADUATION
  AWARD_CEREMONY
  PARENTS_DAY
  OPEN_DAY
  VISITORS
  STUDENT_ACTIVITIES
  CLUBS
  COUNCIL
  LEADERSHIP
  OTHER
}

enum CouncilStatus {
  Active
  Inactive
  Graduated
}

enum CouncilPosition {
  President
  DeputyPresident
  SchoolCaptain
  DeputyCaptain
  AcademicsSecretary
  SportsSecretary
  EntertainmentSecretary
  CleaningSecretary
  MealsSecretary
  BellRinger
  DisciplineSecretary
  HealthSecretary
  LibrarySecretary
  TransportSecretary
  EnvironmentSecretary
  SpiritualSecretary
  TechnologySecretary
  Assistant
  ClassRepresentative
  ClassAssistant
}

enum CouncilDepartment {
  Presidency
  Academics
  Sports
  Entertainment
  Cleaning
  Meals
  Discipline
  Health
  Library
  Transport
  Environment
  Spiritual
  Technology
  General
}

model StudentSession {
  id              String   @id @default(cuid())
  studentId       String
  admissionNumber String
  name            String
  token           String
  expiresAt       DateTime
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime @default(now())

  @@index([studentId])
  @@index([token])
  @@index([expiresAt])
}

model FeeBalanceUpload {
  id            String       @id @default(cuid())
  fileName      String
  fileType      String
  status        String       @default("pending")
  uploadedBy    String
  uploadDate    DateTime     @default(now())
  processedDate DateTime?
  totalRows     Int          @default(0)
  validRows     Int          @default(0)
  skippedRows   Int          @default(0)
  errorRows     Int          @default(0)
  errorLog      Json?
  term          String
  academicYear  String
  feeBalances   FeeBalance[] @relation("UploadToFeeBalances")

  @@map("fee_balance_uploads")
}

model FeeBalance {
  id              String          @id @default(cuid())
  admissionNumber String
  student         databaseStudent @relation("StudentFeeBalances", fields: [admissionNumber], references: [admissionNumber], onDelete: Cascade)

  term          String
  academicYear  String
  amount        Float     @default(0)
  amountPaid    Float     @default(0)
  balance       Float     @default(0)
  paymentStatus String    @default("pending")
  dueDate       DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  uploadBatchId String?
  uploadBatch   FeeBalanceUpload? @relation("UploadToFeeBalances", fields: [uploadBatchId], references: [id], onDelete: Cascade)

  @@unique([admissionNumber, term, academicYear])
  @@map("fee_balances")
}
