// ==========================================
// Prisma Schema - Authentication & Roles
// ==========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==========================================
// Enums
// ==========================================
enum UserRole {
  TEACHER
  PRINCIPAL
  ADMIN
}

// ==========================================
// Core User & Authentication
// ==========================================
model User {
  id              String          @id @default(cuid())
  name            String
  email           String          @unique
  emailVerified   DateTime?
  password        String?
  phone           String?
  role            UserRole        @default(TEACHER) 
  image           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  passwordResets  PasswordReset[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String  @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expires   DateTime

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ==========================================
// Newsletter Subscription
// ==========================================
model Subscriber {
  id        String    @id @default(cuid())
  email     String    @unique // Ensures no duplicate subscriptions
  createdAt DateTime  @default(now())

  @@map("subscribers")
}


model Assignment {
  id                 Int       @id @default(autoincrement())
  title              String
  subject            String
  className          String
  teacher            String
  dueDate            DateTime
  dateAssigned       DateTime
  status             String     
  description        String    @db.Text  // Use TEXT type for long content
  instructions       String?   @db.Text  // Use TEXT type for long content
  assignmentFiles    Json      
  attachments        Json      
  priority           String    
  estimatedTime      String?   
  additionalWork     String?   @db.Text  // Use TEXT type for long content
  teacherRemarks     String?   @db.Text  // Use TEXT type for long content
  feedback           String?   @db.Text  // Use TEXT type for long content
  learningObjectives Json      
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
}

model CounselingEvent {
  id            Int      @id @default(autoincrement())
  counselor     String
  category      String     // e.g. "Drugs", "Relationships", "Worship", "Discipline", "Academics", etc.
  description   String
  notes         String?
  date          DateTime
  time          String
  type          String      // e.g. "Guidance", "Counseling", "Group Session"
  priority      String      // e.g. "High", "Medium", "Low"
  image         String?     // Optional attachment (photo, PDF, DOC)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Event {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  date         DateTime
  time         String
  location     String
  category     String
  type         String
  featured     Boolean  @default(false)
  registration Boolean  @default(false)
  attendees    String   // now a string: "student" or "staff"
  speaker      String
  image        String?  // optional
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model News {
  id          Int      @id @default(autoincrement())
  title       String
  excerpt     String
  fullContent String
  date        DateTime
  category    String
  author      String
  likes       Int      @default(0)
  image       String?  // optional
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model Staff {
  id           Int      @id @default(autoincrement())
  name         String
  role         String          // Principal, Deputy, Teacher, BOM Member, etc.
  position     String?         // Optional additional info
  department   String          // Administration, Sciences, Languages, etc.
  email        String?
  phone        String?
  bio          String
  responsibilities Json         // Store as JSON
  expertise    Json             // Store as JSON
  achievements Json             // Store as JSON
  image        String?          // Optional image path
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model EmailCampaign {
  id             Int       @id @default(autoincrement())
  title          String
  subject        String
  content        String     // HTML content
  recipients     String
  status         String     // "draft" | "published"
  sentAt         DateTime?  
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}
model GalleryImage {
  id          Int        @id @default(autoincrement())
  title       String
  description String?
  category    Category   // Single unified category field
  files       Json       // store array of file paths (images/videos)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum Category {
  GENERAL
  CLASSROOMS
  LABORATORIES
  DORMITORIES
  DINING_HALL
  SPORTS_FACILITIES
  
  // Academic
  TEACHING
  SCIENCE_LAB
  COMPUTER_LAB
  
  // Events
  SPORTS_DAY
  MUSIC_FESTIVAL
  DRAMA_PERFORMANCE
  ART_EXHIBITION
  DEBATE_COMPETITION
  SCIENCE_FAIR
  
  // Administrative
  ADMIN_OFFICES
  STAFF
  PRINCIPAL
  BOARD
  
  // Special Occasions
  GRADUATION
  AWARD_CEREMONY
  PARENTS_DAY
  OPEN_DAY
  VISITORS
  
  // Student Life
  STUDENT_ACTIVITIES
  CLUBS
  COUNCIL
  LEADERSHIP
  
  OTHER
}


model Student {
  id                  Int      @id @default(autoincrement())
  admissionNumber     String   @unique
  name                String
  form                String
  stream              String
  gender              String
  dateOfBirth         DateTime
  enrollmentDate      DateTime
  kcpeMarks           Int?
  previousSchool      String?
  parentName          String
  parentEmail         String?
  parentPhone         String
  emergencyContact    String
  address             String
  medicalInfo         String?
  hobbies             String?
  academicPerformance String
  attendance          String
  disciplineRecord    String
  status              String   @default("Active")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  councilPositions StudentCouncil[]   @relation("StudentToStudentCouncil")
  isClassPrefect      Boolean        @default(false)
  isClassAssistant    Boolean        @default(false)
  isBellRinger        Boolean        @default(false)

  promotionHistory PromotionHistory[]
}


// ==========================================
// Student Council & Leadership
// ==========================================
model StudentCouncil {
  id                String           @id @default(cuid())
  position          CouncilPosition
  department        CouncilDepartment?
  studentId         Int
  student           Student          @relation(name: "StudentToStudentCouncil", fields: [studentId], references: [id], onDelete: Cascade)
  form              String?          // Add for class-specific roles
  stream            String?          // Add for class-specific roles
  startDate         DateTime
  endDate           DateTime?
  status            CouncilStatus    @default(Active)
  image             String?
  achievements      String?
  responsibilities  String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@unique([studentId, position, department, form, stream])
  @@map("student_councils")
}



enum CouncilStatus {
  Active
  Inactive
  Graduated
}




enum CouncilPosition {
  President
  DeputyPresident
  SchoolCaptain
  DeputyCaptain
  AcademicsSecretary
  SportsSecretary
  EntertainmentSecretary
  CleaningSecretary
  MealsSecretary
  BellRinger
  DisciplineSecretary
  HealthSecretary
  LibrarySecretary
  TransportSecretary
  EnvironmentSecretary
  SpiritualSecretary
  TechnologySecretary
  Assistant
  ClassRepresentative  // For class reps
  ClassAssistant       // For class assistants
}
enum CouncilDepartment {
  Presidency
  Academics
  Sports
  Entertainment
  Cleaning
  Meals
  Discipline
  Health
  Library
  Transport
  Environment
  Spiritual
  Technology
  General
}
model PromotionHistory {
  id          Int      @id @default(autoincrement())
  studentId   Int
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  fromForm    String
  toForm      String
  fromStream  String
  toStream    String
  promotedAt  DateTime @default(now())
  promotedBy  String   @default("System")

  @@index([studentId])
  @@index([promotedAt])
}

model SchoolInfo {
  id               Int       @id @default(autoincrement())
  name             String
  description      String   @db.Text
  videoTour        String?   // URL or local path
  videoType        String?   // "youtube" | "file"
  studentCount     Int
  staffCount       Int
  feesBoarding     Float
  feesDay          Float
  feesDistribution Json
  openDate         DateTime
  closeDate        DateTime
  subjects         Json
  departments      Json
  curriculumPDF    String?   // uploaded curriculum PDF path
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}



// Admission Application Model - Simplified
model AdmissionApplication {
  id                String   @id @default(cuid())
  applicationNumber String   @unique
  
  // Personal Information
  firstName         String
  middleName        String?
  lastName          String
  gender            String
  dateOfBirth       DateTime
  nationality       String
  county            String
  constituency      String
  ward              String
  village           String?
  
  // Contact Information
  email            String   @unique
  phone            String
  alternativePhone String?
  postalAddress    String
  postalCode       String?
  
  // Parent/Guardian Information
  fatherName       String?
  fatherPhone      String?
  fatherEmail      String?
  fatherOccupation String?
  motherName       String?
  motherPhone      String?
  motherEmail      String?
  motherOccupation String?
  guardianName     String?
  guardianPhone    String?
  guardianEmail    String?
  guardianOccupation String?
  
  // Academic Information
  previousSchool   String
  previousClass    String
  kcpeYear         Int?
  kcpeIndex        String?
  kcpeMarks        Int?
  meanGrade        String?
  
  // Stream Selection
  preferredStream  String  // SCIENCE, ARTS, BUSINESS, TECHNICAL
  
  // Medical Information
  medicalCondition String?
  allergies        String?
  bloodGroup       String?
  
  // Extracurricular
  sportsInterests  String?
  clubsInterests   String?
  talents          String?
  
  // Timestamps
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Indexes
  @@index([applicationNumber])
  @@index([email])
  @@index([phone])
  @@index([createdAt])
}